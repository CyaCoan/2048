import{_ as E,c as I,d as O,r as b,e as Q,i as Y,f as Z,g as ee,a as te,o as M,B as le,s as ne}from"./resize-e55f1047.js";import{d as R,c as C,a as T,n as D,o as G,p as W,k as L,e as w,w as N,b as A,t as $,u as S,f as j}from"./index-3ef900cd.js";const oe=s=>(W("data-v-0eccc192"),s=s(),L(),s),se=oe(()=>T("div",{class:"border"},null,-1)),ae=R({__name:"HealthPointBar",props:{hp:{},max:{},side:{}},setup(s){const v=s;return(l,f)=>(G(),C("div",{class:"container-hp",style:D({"justify-content":`${v.side}`})},[T("div",{style:D({"background-color":`${l.hp/l.max>.2?"#2add9c":"#dc3023"}`,width:`${(l.hp<l.max?l.hp/l.max:1)*36.25}rem`,height:"2rem",margin:"0 0.375rem"})},null,4),se],4))}});const re=E(ae,[["__scopeId","data-v-0eccc192"]]),ue=(s,v,l)=>{const f=l[0].length;for(let e=0;e<f;e++)e!==v&&l[s][e]!==null&&(l[s][e][2]!=="frozen"?l[s][e]=null:l[s][e][2]="normal");return l},ie=(s,v,l)=>{const f=l.length;for(let e=0;e<f;e++)e!==s&&l[e][v]!==null&&(l[e][v][2]!=="frozen"?l[e][v]=null:l[e][v][2]="normal");return l},ce=(s,v,l)=>{const f=l.length,e=l[0].length;for(let m=0;m<f;m++)for(let h=0;h<e;h++){let o=Math.abs(s-m),_=+Math.abs(v-h);o<=1&&_<=1&&!(o===0&&_===0)&&l[m][h]!==null&&(l[m][h][2]!=="frozen"?l[m][h]=null:l[m][h][2]="normal")}return l},fe=(s,v,l,f)=>(f+=l[s][v][0],f);let ve=0;const me=()=>ve+=1,ge=4096;function he(){const s=I(),v=I(),l=w(0),f=w(ge),e=w([-1,-1]),m=w(4),h=w(4),o=w(Array.from({length:m.value}).map(()=>Array.from({length:h.value}).map(()=>null))),_=w(!1),y=w(!1);N(_,()=>{_.value===!0&&v.trigger()});const k=t=>{const n=t.length,u=t[0].length;for(let i=0;i<n;i++)for(let c=0;c<u;c++)if(t[i][c]===null||i<n-1&&t[i][c]&&t[i+1][c]&&t[i][c][0]===t[i+1][c][0]||c<u-1&&t[i][c]&&t[i][c+1]&&t[i][c][0]===t[i][c+1][0])return!1;return!0},d=(t,n)=>{const u=Math.random()<.9?2:4,i=Math.floor(Math.random()*m.value),c=Math.floor(Math.random()*h.value);return t[i][c]!==null?d(t,n):t[i][c]=[u,me(),n],k(t)&&(y.value=!0),t},x=()=>{l.value=0,y.value=!1,_.value=!1;let t=Array.from({length:m.value}).map(()=>Array.from({length:h.value}).map(()=>null));t=d(t,"normal"),t=d(t,"normal"),o.value=t},p=t=>{let n=O(o.value);const u=ee(t);n=b(n,u);const i=n.length,c=n[0].length;for(let g=0;g<c;g++){const r=[];for(let a=0;a<i;a++)n[a][g]!==null&&(r.push(n[a][g]),n[a][g]=null);let z=0;const B=r.length;for(let a=0;a<B;a++){if(a<B-1&&r[a][0]===r[a+1][0]&&r[a][2]!=="frozen"&&r[a+1][2]!=="frozen"){const H=r[a][0]*2,J=r[a+1][1];let P="normal";r[a][2]!=="normal"&&r[a+1][2]==="normal"&&(P=r[a][2]),r[a][2]==="normal"&&r[a+1][2]!=="normal"&&(P=r[a+1][2]),P!=="normal"&&(e.value=[z,g],e.value=Q(e.value,4,4-u)),n[z][g]=[H,J,P],a++,l.value+=H}else n[z][g]=r[a];z++}}n=b(n,4-u),Y(n,o.value)||(n=d(n,"normal")),o.value=n,s.trigger(t)},q=()=>p("up"),F=()=>p("down"),K=()=>p("left"),U=()=>p("right"),X=A(()=>{let t=0,n=0,u=0;const i=o.value.length,c=o.value[0].length;for(let g=0;g<i;g++)for(let r=0;r<c;r++)o.value[g][r]!==null&&o.value[g][r][0]>t&&(t=o.value[g][r][0],n=g,u=r);return[t,n,u]});return{board:o,score:l,hp:f,trigger_pos:e,isStuck:y,hasWon:_,biggestTile:X,initialize:x,setRandomTile:d,deleteTile:(t,n)=>{o.value[t][n]=null},setTileProp:(t,n,u)=>{o.value[t][n]!==null&&(o.value[t][n][2]=u)},triggerTileProp:t=>{Z(t.length===2);const n=t[0],u=t[1];if(o.value[n][u]===null)return;switch(o.value[n][u][2]){case"row":o.value=ue(n,u,o.value);break;case"column":o.value=ie(n,u,o.value);break;case"bomb":o.value=ce(n,u,o.value);break;case"heal":f.value=fe(n,u,o.value,f.value);break;default:return}o.value[n][u][2]="normal"},move:p,up:q,down:F,left:K,right:U,onWon:v.on,onMove:s.on}}const V=s=>(W("data-v-b9ae583e"),s=s(),L(),s),_e={class:"container-game"},pe={class:"container-header"},de=V(()=>T("div",{style:{width:"35%",height:"3.5rem"}},[T("div",{class:"hp-text"},"生命值")],-1)),we=V(()=>T("span",{style:{flex:"1 1 0%"}},null,-1)),ke={style:{width:"35%",height:"3.5rem"}},Te={class:"hp-value"},ye=R({__name:"DuelGame",emits:["up","down","left","right","update:seed"],setup(s,{emit:v}){const l=()=>ne(656,804);l(),window.addEventListener("resize",l);const f=v,e=he();e.initialize();const m=w(1024),h=m.value,o=te(A(()=>m.value),{duration:100}),_=A(()=>!(e.isStuck.value||y.value)),y=A(()=>e.trigger_pos.value[0]!==-1&&e.trigger_pos.value[1]!==-1);return N(y,()=>{y.value===!0&&setTimeout(()=>{e.triggerTileProp(e.trigger_pos.value),e.trigger_pos.value=[-1,-1]},300)}),M(["ArrowUp","w"],()=>{_.value&&(e.up(),f("up"))}),M(["ArrowDown","s"],()=>{_.value&&(e.down(),f("down"))}),M(["ArrowLeft","a"],()=>{_.value&&(e.left(),f("left"))}),M(["ArrowRight","d"],()=>{_.value&&(e.right(),f("right"))}),M("Enter",()=>{const k=e.biggestTile.value[0],d=e.biggestTile.value[1],x=e.biggestTile.value[2];k<64||k>m.value||(e.deleteTile(d,x),m.value-=k,e.isStuck.value===!0&&(e.isStuck.value=!1))}),M(" ",()=>{const k=e.biggestTile.value[0],d=e.biggestTile.value[1],x=e.biggestTile.value[2];if(k<64)return;let p="normal";switch(Math.floor(Math.random()*4)){case 0:p="row";break;case 1:p="column";break;case 2:p="bomb";break;case 3:p="heal";break}e.setTileProp(d,x,p)}),M("f",()=>{e.board.value=e.setRandomTile(e.board.value,"frozen")}),(k,d)=>(G(),C("div",_e,[T("div",pe,[de,we,T("div",ke,[T("div",Te,$(S(o).toFixed(0))+"/"+$(S(h)),1)])]),j(re,{hp:S(o),max:S(h),side:"left"},null,8,["hp","max"]),j(le,{board:S(e).board.value,style:{bottom:"0rem"}},null,8,["board"])]))}});const Ae=E(ye,[["__scopeId","data-v-b9ae583e"]]);export{Ae as default};
